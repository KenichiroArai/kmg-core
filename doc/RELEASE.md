# リリース手順

このドキュメントでは、KMGコアのリリース手順について説明します。

## 前提条件

- GitHub アカウントを持っていること
- リポジトリへのプッシュ権限があること
- 以下のツールがインストールされていること：
  - Java 21
  - Maven 3.x
  - Git
  - GitHub CLI（オプション：プルリクエストの自動作成に必要）

## リリースプロセス

リリースは以下の2つの方法で実行できます：

### 1. 自動リリーススクリプトを使用する方法

`scripts/release.bat` を使用して自動的にリリースを実行できます。

```bash
release.bat [作業ブランチ] [リリースブランチ] [バージョン]
# 例：release.bat features/release main 1.0.0
```

スクリプトは以下の処理を自動的に実行します：

1. 作業ブランチの作成と切り替え
2. pom.xml のバージョン更新
3. 変更のコミットとプッシュ
4. プルリクエストの作成（GitHub CLI使用時）
5. タグの作成とプッシュ

### 2. 手動でリリースを実行する方法

1. 作業ブランチを作成
   ```bash
   git checkout -b features/release-vX.Y.Z
   ```

2. pom.xml のバージョンを更新
   ```bash
   mvn versions:set -DnewVersion=X.Y.Z
   ```

3. 変更をコミットしプッシュ
   ```bash
   git add pom.xml
   git commit -m "バージョンをX.Y.Zに更新"
   git push origin features/release-vX.Y.Z
   ```

4. プルリクエストを作成し、マージ

5. タグを作成しプッシュ
   ```bash
   git tag vX.Y.Z
   git push origin vX.Y.Z
   ```

## CI/CDプロセス

### 継続的インテグレーション（CI）

プルリクエスト作成時に以下の検証が自動実行されます：

- Mavenビルド
- JUnitテスト実行
- テストカバレッジチェック（100%必須）
- 依存関係のセキュリティチェック

### 継続的デリバリー（CD）

タグのプッシュまたはGitHubリリースの作成時に以下が自動実行されます：

1. Mavenビルドとテスト
2. GitHub Packagesへの成果物の公開
3. GitHubリリースの作成
   - JARファイルの添付
   - テストレポートの生成
   - カバレッジレポートの生成

## トラブルシューティング

### よくある問題と解決方法

1. テストカバレッジが100%未満の場合
   - 不足しているテストを追加
   - カバレッジレポートで未テスト箇所を確認

2. 依存関係のセキュリティ警告
   - 依存ライブラリのバージョンを更新
   - 代替ライブラリの検討

3. GitHub Packagesへの公開失敗
   - GitHub トークンの権限を確認
   - Maven設定の確認

## 注意事項

- バージョン番号は[セマンティックバージョニング](https://semver.org/)に従う
- リリースブランチへのマージは必ずプルリクエストを通じて行う
- 重要な変更がある場合はCHANGELOG.mdを更新する
